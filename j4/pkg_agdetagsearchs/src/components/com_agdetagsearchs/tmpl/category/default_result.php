<?php
/**
 * @subpackage  Agdetagsearch
 *
 * @copyright   Copyright (C) 2018 Astrid GÃ¼nther & Dimitry Engbert All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */

defined('_JEXEC') or die;

// Save the results in the variable items and count them
$this->items = $this->get('data');
$items = $this->get('data');
if (isset($this->total)) {
	$total = $this->total;
} else {
	$total = 0;
}
$n = count($this->get('data'));

$columns = 3;
$spanClass = 'span4';
$agtagscolumnlimit = 3;

if ($this->state->get('agtagscolumnlimit')) {
	$agtagscolumnlimit = $this->state->get('agtagscolumnlimit');
}

if ($agtagscolumnlimit == 1) {
	$spanClass = 'span12';
	$columns = 1;
}
if ($agtagscolumnlimit == 2) {
	$spanClass = 'span6';
	$columns = 2;
}
if ($agtagscolumnlimit == 3) {
	$spanClass = 'span4';
	$columns = 3;
}
if ($agtagscolumnlimit == 4) {
	$spanClass = 'span3';
	$columns = 4;
}
if ($n < $columns) {
	$columns = $n;
}
if ($columns != 0) {
	$rows = ceil($n/$columns);
} else {
	$rows = 0;
}

?>

	<?php if (!isset($this->resultSumUnique) || $this->resultSumUnique == false || $n == 0) : ?>
		<p> <?php echo JText::_('COM_AGDETAGSEARCH_NO_ITEMS'); ?></p>
	<?php else : ?>
		<p><?php echo JText::plural('COM_AGDETAGSEARCH_ITEMS_FOUND', $total); ?></p>

		<!-- Start a fluid row layout with columns set in the variable $columns -->
		<div class="items-row row-fluid">
		<?php for ($i = 0, $n; $i < $n; $i ++) : //foreach ($items as $i => $item) : ?>
			<!-- Start a new row if there are more items -->
			<?php if ($rows > 1 && $i !== 0 && $i % $columns == 0) :?>
				</div><div class="items-row row-fluid">
			<?php endif; ?>

			<!-- Jump through the items and display them -->
			<?php $item = $items[$i]; ?>
			<?php if ($item->core_state == 0) : ?>
				<div class="system-unpublished cat-list-row<?php echo $i % 2; ?>">
			<?php else : ?>
				<div class="<?php echo $spanClass ?> cat-list-row<?php echo $i % 2; ?> clearfix" >
				<article class="item">
				<?php //todo bisher sind nur 2 contentypen mit richtigen links hinterlegt ?>
				<?php
				if (($item->type_alias == 'com_users.category') || ($item->type_alias == 'com_agdetagsearchs.agdetagsearch') || ($item->type_alias == 'com_banners.category')) : ?>
					<h3>
						<?php echo $this->escape($item->core_title); ?>
					</h3>
				<?php else : ?>
					<?php //echo print_r($item) ?>
					<h3>
						<a href="<?php echo JRoute::_(TagsHelperRoute::getItemRoute($item->content_item_id, $item->core_alias, $item->core_catid, $item->core_language, $item->type_alias, $item->router)); ?>">
							<?php echo $this->escape($item->core_title); ?>
						</a>
					</h3>
				<?php endif; ?>
			<?php endif; ?>
			<?php // Content is generated by content plugin event "onContentAfterTitle" ?>
			<?php //echo $item->event->afterDisplayTitle; ?>
			<?php $images  = json_decode($item->core_images); ?>
			<figure class="item_img img-intro">
			<?php if ($this->params->get('tag_list_show_item_image', 1) == 1 && !empty($images->image_intro)) : ?>
				<a href="<?php echo JRoute::_(TagsHelperRoute::getItemRoute($item->content_item_id, $item->core_alias, $item->core_catid, $item->core_language, $item->type_alias, $item->router)); ?>">
				<img src="<?php echo htmlspecialchars($images->image_intro); ?>" alt="<?php echo htmlspecialchars($images->image_intro_alt); ?>">
				</a>
			<?php endif; ?>
			</figure>
			<?php if ($this->params->get('tag_list_show_item_description', 1)) : ?>
				<?php // Content is generated by content plugin event "onContentBeforeDisplay" ?>
				<?php //echo $item->event->beforeDisplayContent; ?>
				<span class="tag-body">
					<?php echo JHtml::_('string.truncate', $item->core_body, $this->params->get('tag_list_item_maximum_characters')); ?>
				</span>
				<?php // Content is generated by content plugin event "onContentAfterDisplay" ?>
				<?php //echo $item->event->afterDisplayContent; ?>
			<?php endif; ?>

			<!-- Show the tags as image -->
			<?php
				/*$item->tags = new JHelperTags;
				$item->tags->getItemTags('com_content.article', $item->content_item_id);
				$item->tagLayout = new JLayoutFile('joomla.content.agtags');
				$tags = $item->tags->itemTags;
				echo $item->tagLayout->render($tags);*/
			?>

			<!-- More Todo Security -->
			<a class="btn btn-info" href="<?php
			echo JRoute::_(TagsHelperRoute::getItemRoute($item->content_item_id, $item->core_alias, $item->core_catid, $item->core_language, $item->type_alias, $item->router));
			?>">
				<span>
					<?php echo JText::_('COM_AGDETAGSEARCH_READ_MORE');  ?>
				</span>
			</a>

			</article>
			</div>

		<?php endfor; ?>
		</div>

	<?php endif; ?>

	<?php if ($this->params->get('show_pagination')) : ?>
		<div class="pagination">
			<?php if ($this->params->def('show_pagination_results', 1)) : ?>
				<p class="counter">
					<?php echo $this->pagination->getPagesCounter(); ?>
				</p>
			<?php endif; ?>
			<?php
				echo $this->pagination->getPagesLinks();
			?>
		</div>
	<?php endif; ?>